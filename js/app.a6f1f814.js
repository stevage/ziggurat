(function(e){function t(t){for(var o,i,l=t[0],s=t[1],c=t[2],d=0,p=[];d<l.length;d++)i=l[d],r[i]&&p.push(r[i][0]),r[i]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);u&&u(t);while(p.length)p.shift()();return n.push.apply(n,c||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],o=!0,l=1;l<a.length;l++){var s=a[l];0!==r[s]&&(o=!1)}o&&(n.splice(t--,1),e=i(i.s=a[0]))}return e}var o={},r={app:0},n=[];function i(t){if(o[t])return o[t].exports;var a=o[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=o,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(a,o,function(t){return e[t]}.bind(null,o));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;n.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"56d7":function(e,t,a){"use strict";a.r(t);a("cadf"),a("551c"),a("097d");var o,r,n,i,l=a("2b0e"),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("div",{attrs:{id:"middle"}},[a("div",{attrs:{id:"sidebar"}},[a("h2",[e._v("Ziggurat Computer")]),e._v("Use the polygon tool to select your precinct of interest."),a("div",{attrs:{id:"setbacks"}},[a("h3",[e._v("Define the setbacks")]),e._l(e.setbacks,function(t){return a("div",{staticClass:"setback"},[e._v("→"),a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.x,expression:"setback.x",modifiers:{number:!0}}],staticClass:"horizontal",domProps:{value:t.x},on:{input:function(a){a.target.composing||e.$set(t,"x",e._n(a.target.value))},blur:function(t){e.$forceUpdate()}}}),e._v("m    \nHeight:"),a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.h,expression:"setback.h",modifiers:{number:!0}}],staticClass:"vertical",domProps:{value:t.h},on:{input:function(a){a.target.composing||e.$set(t,"h",e._n(a.target.value))},blur:function(t){e.$forceUpdate()}}}),e._v("m")])}),a("br"),a("div",{staticClass:"min-floor-area"},[a("label",[e._v("Min. area per floor  ")]),a("input",{directives:[{name:"model",rawName:"v-model.number",value:e.minFloorArea,expression:"minFloorArea",modifiers:{number:!0}}],domProps:{value:e.minFloorArea},on:{input:function(t){t.target.composing||(e.minFloorArea=e._n(t.target.value))},blur:function(t){e.$forceUpdate()}}}),e._v("m²")]),a("br"),a("button",{attrs:{id:"recalculate"},on:{click:function(t){e.recalculate()}}},[e._v("Recalculate!")])],2),e.floorArea?a("div",{attrs:{id:"total"}},[a("h2",[e._v("Developable floor area")]),a("h3",[e._v("Separate lots")]),e._l(e.floorArea.floors,function(t,o){return a("div",{staticClass:"floor"},[a("span",{staticClass:"floor-num"},[e._v(e._s(o?"Floor "+o:"Ground")+":")]),a("span",{staticClass:"floor-area"},[e._v(e._s(Math.round(t).toLocaleString())+" m²")])])}),a("div",{staticClass:"floor-total"},[a("span",{staticClass:"floor-num"},[e._v("Total")]),a("span",{staticClass:"floor-area"},[e._v(e._s(Math.round(e.floorArea.total).toLocaleString())+" m²")])]),a("div",{staticClass:"checkbox"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.showSeparate,expression:"showSeparate"}],attrs:{type:"checkbox",id:"showSeparate"},domProps:{checked:Array.isArray(e.showSeparate)?e._i(e.showSeparate,null)>-1:e.showSeparate},on:{change:function(t){var a=e.showSeparate,o=t.target,r=!!o.checked;if(Array.isArray(a)){var n=null,i=e._i(a,n);o.checked?i<0&&(e.showSeparate=a.concat([n])):i>-1&&(e.showSeparate=a.slice(0,i).concat(a.slice(i+1)))}else e.showSeparate=r}}}),a("label",{attrs:{for:"showSeparate"}},[e._v("Show on map")])]),a("h3",[e._v("After amalgamation")]),e._l(e.amalgamatedFloorArea.floors,function(t,o){return a("div",{staticClass:"floor"},[a("span",{staticClass:"floor-num"},[e._v(e._s(o?"Floor "+o:"Ground")+":")]),a("span",{staticClass:"floor-area"},[e._v(e._s(Math.round(t).toLocaleString())+" m²")])])}),a("div",{staticClass:"floor-total"},[a("span",{staticClass:"floor-num"},[e._v("Total")]),a("span",{staticClass:"floor-area"},[e._v(e._s(Math.round(e.amalgamatedFloorArea.total).toLocaleString())+" m²")])]),a("div",{staticClass:"checkbox"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.showAmalgamated,expression:"showAmalgamated"}],attrs:{type:"checkbox",id:"showAmalgamated"},domProps:{checked:Array.isArray(e.showAmalgamated)?e._i(e.showAmalgamated,null)>-1:e.showAmalgamated},on:{change:function(t){var a=e.showAmalgamated,o=t.target,r=!!o.checked;if(Array.isArray(a)){var n=null,i=e._i(a,n);o.checked?i<0&&(e.showAmalgamated=a.concat([n])):i>-1&&(e.showAmalgamated=a.slice(0,i).concat(a.slice(i+1)))}else e.showAmalgamated=r}}}),a("label",{attrs:{for:"showAmalgamated"}},[e._v("Show on map")])])],2):e._e()]),a("div",{attrs:{id:"map"}})]),e._m(0)])},c=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"bottom"}},[e._v("Developed by "),a("a",{attrs:{href:"https://hire.stevebennett.me"}},[e._v("Steve Bennett")]),e._v(" for "),a("a",{attrs:{href:"https://frontiersi.com.au/"}},[e._v("Frontier SI")]),e._v(".")])}],u=(a("4917"),a("75fc")),d={name:"app",components:{},data:function(){return{floorArea:void 0,amalgamatedFloorArea:void 0,showSeparate:!0,showAmalgamated:!0,setbacks:[{x:2,h:0},{x:3,h:5},{x:4,h:15},{h:30}],minFloorArea:100}},watch:{setbacks:function(e){y()},showSeparate:function(e){n.setLayoutProperty("separateZiggurat","visibility",e?"visible":"none")},showAmalgamated:function(e){n.setLayoutProperty("amalgamatedZiggurat","visibility",e?"visible":"none")}},methods:{recalculate:function(){y()}},mounted:function(){window.app=this,k()}},p=a("6d93"),f=p.fetch,m=a("7915"),h=a("45b9"),v=a("6ee6"),g=a("e192"),b=a("595b"),w=a("b6a7");a("b3a1").formulaToExpression;function _(e,t){var a=0,o=[];return b.featureEach(e,function(e,r){var i=!!t&&!b.booleanDisjoint(e,t);n.setFeatureState({id:r,source:"parcels"},{selected:i}),e._selected=i,a+=i?1:0,i&&o.push(e)}),console.log(a+" parcels found within precinct"),o}function y(e,t){if(o.getAll().features.length&&(i=b.combine(o.getAll())),i&&i.features.length){i&&console.log(""+i.features[0].geometry.coordinates[0].length-1+" vertices.");var a=_(r,i),l=w.makeZiggurat(a,window.app.setbacks,window.app.minFloorArea);n.U.update("ziggurat",l),window.app.floorArea=w.totalFloorArea(l);var s=[b.union.apply(b,Object(u["a"])(a))],c=w.makeZiggurat(s,window.app.setbacks,window.app.minFloorArea);window.app.amalgamatedFloorArea=w.totalFloorArea(c),n.U.update("amalgamatedZiggurat",c),t&&o.deleteAll()}}var A=window.location.host.match(/localhost/)&&!window.location.hash.match(/prod/)||window.location.hash.match(/dev/),x={version:8,sources:{},layers:[]};function k(){g.accessToken="pk.eyJ1Ijoic3RldmFnZSIsImEiOiJGcW03aExzIn0.QUkUmTGIO3gGt83HiRIjQw",n=new g.Map({container:"map",style:A?x:"https://api.maptiler.com/maps/bright/style.json?key=WiUMgs9DgAoPMp824LNB",center:[145.2726,-37.816],bearing:68,zoom:A?16:13}),a("8936").init(n),window.map=n,n.U.onLoad(function(){n.U.addGeoJSON("parcels").addLine("parcels-outline",{lineColor:"hsl(240,50%,80%)"}),n.U.addGeoJSON("ziggurat").addFillExtrusion("separateZiggurat",{fillExtrusionColor:{property:"height",stops:[[0,"hsl(120, 60%,40%)"],[1,"hsl(210, 95%,60%)"],[30,"hsl(230, 95%,80%)"]]},fillExtrusionOpacity:.9,fillExtrusionHeight:["get","height"]}),n.U.addGeoJSON("amalgamatedZiggurat").addFillExtrusion("amalgamatedZiggurat",{fillExtrusionColor:"grey",fillExtrusionOpacity:.5,fillExtrusionHeight:["+",["get","height"],.5]})}),o=new v({displayControlsDefault:!1,controls:{polygon:!0,trash:!0}}),n.addControl(o,"top-left"),n.on("draw.create",function(e){return y(e,!0)}),f("data/out.geobuf").then(function(e){return e.arrayBuffer()}).then(function(e){r=h.decode(new m(e)),n.U.onLoad(function(){return n.U.update("parcels",r)})})}var S=d,C=(a("b126"),a("ff34"),a("6964"),a("2877")),F=Object(C["a"])(S,s,c,!1,null,null,null);F.options.__file="App.vue";var O=F.exports;l["a"].config.productionTip=!1,new l["a"]({render:function(e){return e(O)}}).$mount("#app")},6964:function(e,t,a){"use strict";var o=a("ff0f"),r=a.n(o);r.a},b6a7:function(e,t,a){"use strict";a.r(t),a.d(t,"totalFloorArea",function(){return i}),a.d(t,"makeZiggurat",function(){return l});var o=a("5d73"),r=a.n(o),n=(a("ac6a"),a("595b"));function i(e){var t=3,a={total:0,floors:[]};return n.featureEach(e,function(e){for(var o=n.area(e),r=Math.floor(e.properties.height/t),i=0;i<r;i++)a.floors[i]=(a.floors[i]||0)+o;a.total=a.total+o*r}),a}function l(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,o=[];return e.forEach(function(e){var i=e,l=!0,s=!1,c=void 0;try{for(var u,d=r()(t);!(l=(u=d.next()).done);l=!0){var p=u.value;if(!p.x){i.properties={height:p.h},o.push(i);break}var f=n.buffer(i,-p.x,{units:"meters"});if(!(f&&n.area(f)>a)){i.properties={height:p.h},o.push(i);break}var m=n.difference(i,f);m.properties={height:p.h},o.push(m),i=f}}catch(h){s=!0,c=h}finally{try{l||null==d.return||d.return()}finally{if(s)throw c}}}),console.log("Total setback polygons: "+o.length),n.featureCollection(o)}},ff0f:function(e,t,a){}});
//# sourceMappingURL=app.a6f1f814.js.map