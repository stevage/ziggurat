(function(e){function t(t){for(var o,i,l=t[0],s=t[1],u=t[2],f=0,p=[];f<l.length;f++)i=l[f],n[i]&&p.push(n[i][0]),n[i]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);c&&c(t);while(p.length)p.shift()();return a.push.apply(a,u||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],o=!0,l=1;l<r.length;l++){var s=r[l];0!==n[s]&&(o=!1)}o&&(a.splice(t--,1),e=i(i.s=r[0]))}return e}var o={},n={app:0},a=[];function i(t){if(o[t])return o[t].exports;var r=o[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=o,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(r,o,function(t){return e[t]}.bind(null,o));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var u=0;u<l.length;u++)t(l[u]);var c=s;a.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"56d7":function(e,t,r){"use strict";r.r(t);r("cadf"),r("551c"),r("097d");var o,n,a,i=r("2b0e"),l=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("div",{attrs:{id:"middle"}},[r("div",{attrs:{id:"sidebar"}},[r("h2",[e._v("Ziggurat Computer")]),e._v("Use the polygon tool to select your precinct of interest."),r("div",{attrs:{id:"setbacks"}},[r("h3",[e._v("Define the setbacks")]),e._l(e.setbacks,function(t){return r("div",{staticClass:"setback"},[e._v("→"),r("input",{directives:[{name:"model",rawName:"v-model.number",value:t.x,expression:"setback.x",modifiers:{number:!0}}],staticClass:"horizontal",domProps:{value:t.x},on:{input:function(r){r.target.composing||e.$set(t,"x",e._n(r.target.value))},blur:function(t){e.$forceUpdate()}}}),e._v("m    \nHeight: "),r("input",{directives:[{name:"model",rawName:"v-model.number",value:t.h,expression:"setback.h",modifiers:{number:!0}}],staticClass:"vertical",domProps:{value:t.h},on:{input:function(r){r.target.composing||e.$set(t,"h",e._n(r.target.value))},blur:function(t){e.$forceUpdate()}}}),e._v("m")])}),r("br"),r("div",{staticClass:"min-floor-area"},[r("label",[e._v("Min. area per floor  ")]),r("input",{directives:[{name:"model",rawName:"v-model.number",value:e.minFloorArea,expression:"minFloorArea",modifiers:{number:!0}}],domProps:{value:e.minFloorArea},on:{input:function(t){t.target.composing||(e.minFloorArea=e._n(t.target.value))},blur:function(t){e.$forceUpdate()}}}),e._v("m²")]),r("br"),r("button",{attrs:{id:"recalculate"},on:{click:function(t){e.recalculate()}}},[e._v("Recalculate!")])],2),e.floorArea?r("div",{attrs:{id:"total"}},[r("h2",[e._v("Developable floor area")]),e._l(e.floorArea.floors,function(t,o){return r("div",{staticClass:"floor"},[r("span",{staticClass:"floor-num"},[e._v(e._s(o?"Floor "+o:"Ground")+": ")]),r("span",{staticClass:"floor-area"},[e._v(e._s(Math.round(t).toLocaleString())+" m²")])])}),r("div",{staticClass:"floor-total"},[r("span",{staticClass:"floor-num"},[e._v("Total")]),r("span",{staticClass:"floor-area"},[e._v(e._s(Math.round(e.floorArea.total).toLocaleString())+" m²")])])],2):e._e()]),r("div",{attrs:{id:"map"}})]),e._m(0)])},s=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"bottom"}},[e._v("Developed by "),r("a",{attrs:{href:"https://hire.stevebennett.me"}},[e._v("Steve Bennett")]),e._v(" for "),r("a",{attrs:{href:"https://frontiersi.com.au/"}},[e._v("Frontier SI")]),e._v(".")])}],u={name:"app",components:{},data:function(){return{floorArea:void 0,setbacks:[{x:2,h:0},{x:3,h:5},{x:4,h:15},{h:30}],minFloorArea:100}},computed:{setbackFields:function(){}},watch:{setbacks:function(e){y()}},methods:{recalculate:function(){y()}},mounted:function(){window.app=this}},c=r("6d93"),f=c.fetch,p=r("7915"),d=r("45b9"),v=r("6ee6"),h=r("e192"),m=r("595b"),g=r("6e49");r("b3a1").formulaToExpression;function b(e,t){var r=0;m.featureEach(e,function(e,o){var n=!!t&&!m.booleanDisjoint(e,t);a.setFeatureState({id:o,source:"parcels"},{selected:n}),e._selected=n,r+=n?1:0}),console.log(r+" parcels found within precinct")}function y(e){var t=m.combine(o.getAll());t&&console.log(""+t.features[0].geometry.coordinates[0].length-1+" vertices."),b(n,t);var r=g.makeZigguraut(n,window.app.setbacks,window.app.minFloorArea);a.getSource("ziggurat").setData(r),window.app.floorArea=g.totalFloorArea(r)}function _(e){h.accessToken="pk.eyJ1Ijoic3RldmFnZSIsImEiOiJGcW03aExzIn0.QUkUmTGIO3gGt83HiRIjQw",a=new h.Map({container:"map",style:"https://maps.tilehosting.com/styles/streets/style.json?key=WiUMgs9DgAoPMp824LNB",center:[145.2726,-37.816],bearing:68,zoom:13}),a.onLoad=function(e){return a.loaded()?e():a.on("load",e)},a.onLoad(function(){a.addSource("parcels",{type:"geojson",data:e,generateId:!0}),a.addLayer({id:"parcels-outline",source:"parcels",type:"line",paint:{"line-color":"hsl(240,50%,80%)"}}),a.addLayer({id:"parcels-selected",source:"parcels",type:"fill",paint:{"fill-color":["case",["to-boolean",["feature-state","selected"]],"darkgrey","transparent"]}}),a.addSource("ziggurat",{type:"geojson",data:m.featureCollection([])}),a.addLayer({id:"heights",type:"fill-extrusion",source:"ziggurat",paint:{"fill-extrusion-color":{property:"height",stops:[[0,"hsl(120, 60%,40%)"],[1,"hsl(210, 95%,60%)"],[30,"hsl(230, 95%,80%)"]]},"fill-extrusion-opacity":.9,"fill-extrusion-height":{type:"identity",property:"height"}}})}),o=new v({displayControlsDefault:!1,controls:{polygon:!0,trash:!0}}),a.addControl(o,"top-left"),a.on("draw.create",y),a.on("draw.delete",y),a.on("draw.update",y)}f("data/out.geobuf").then(function(e){return e.arrayBuffer()}).then(function(e){n=d.decode(new p(e)),_(n)});var w=u,x=(r("b126"),r("ff34"),r("6964"),r("2877")),k=Object(x["a"])(w,l,s,!1,null,null,null);k.options.__file="App.vue";var A=k.exports;i["a"].config.productionTip=!1,new i["a"]({render:function(e){return e(A)}}).$mount("#app")},6964:function(e,t,r){"use strict";var o=r("ff0f"),n=r.n(o);n.a},"6e49":function(e,t,r){"use strict";r.r(t),r.d(t,"totalFloorArea",function(){return n}),r.d(t,"makeZigguraut",function(){return a});r("ac4d"),r("8a81"),r("ac6a");var o=r("595b");function n(e){var t=3,r={total:0,floors:[]};return o.featureEach(e,function(e){for(var n=o.area(e),a=Math.floor(e.properties.height/t),i=0;i<a;i++)r.floors[i]=(r.floors[i]||0)+n;r.total=r.total+n*a}),r}function a(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,n=[];return o.featureEach(e,function(e){if(e._selected){var a=e,i=!0,l=!1,s=void 0;try{for(var u,c=t[Symbol.iterator]();!(i=(u=c.next()).done);i=!0){var f=u.value;if(!f.x){a.properties={height:f.h},n.push(a);break}var p=o.buffer(a,-f.x,{units:"meters"});if(!(p&&o.area(p)>r)){a.properties={height:f.h},n.push(a);break}var d=o.difference(a,p);d.properties={height:f.h},n.push(d),a=p}}catch(v){l=!0,s=v}finally{try{i||null==c.return||c.return()}finally{if(l)throw s}}}}),console.log("Total setback polygons: "+n.length),o.featureCollection(n)}},ff0f:function(e,t,r){}});
//# sourceMappingURL=app.abe5de0e.js.map